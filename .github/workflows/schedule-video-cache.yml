name: Schedule Video Cache Update

on:
  schedule:
    # 每天台灣時間中午 12:15 執行（UTC 04:15 = 台灣時間 12:15）
    - cron: '15 4 * * *'

  workflow_dispatch:  # 允許手動觸發

jobs:
  trigger-update:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger video cache update workflow in feature branch
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            try {
              const result = await github.rest.actions.createWorkflowDispatch({
                owner: context.repo.owner,
                repo: context.repo.repo,
                workflow_id: 'update-video-cache.yml',
                ref: 'feature/video-performance-analytics'
              });
              console.log('✅ 成功觸發 feature/video-performance-analytics 分支的影片快取更新');
            } catch (error) {
              core.setFailed(`觸發 workflow 失敗: ${error.message}`);
            }
