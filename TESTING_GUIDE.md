# 影片表現分析功能 - 測試指引

## 🚀 啟動開發服務器

### 1. 後端服務器
```bash
npm run dev
```

後端服務器會在 `http://localhost:3001` 啟動

### 2. 前端（如果是分離的）
```bash
# 如果前端是獨立運行
npm start
```

---

## 📋 測試清單

### ✅ 階段 1：基本功能測試

#### **1.1 登入 YouTube**
- [ ] 打開應用程序
- [ ] 點擊 YouTube 登入按鈕
- [ ] 確認成功登入（顯示用戶頭像）

#### **1.2 進入影片表現分析頁面**
- [ ] 點擊「影片表現分析」標籤
- [ ] 確認看到年度選擇器（1/2/3/5 年）
- [ ] 確認看到「開始分析」按鈕

---

### ✅ 階段 2：數據獲取測試

#### **2.1 基本分析（1 年）**
1. 選擇「1 年」
2. 點擊「開始分析」
3. **觀察後端日誌**（重要！）：

**預期日誌輸出：**
```
[Analytics API] 開始分析頻道: UCUR0yPZFOmf7maQWGlA6q2w
[Analytics] 開始獲取頻道影片列表（近 365 天）...
[Analytics]   截止日期: 2024/11/4
[Analytics]   → 步驟 1: 獲取頻道資訊...
[Analytics]     ✓ 上傳播放清單 ID: UU...
[Analytics]   → 步驟 2: 開始分頁查詢影片...
[Analytics]     → 正在獲取第 1 頁 (pageToken: 首頁)
[Analytics]       ✓ 本頁: 50/50 支影片在範圍內 (2025/11/3 ~ 2025/3/1)
[Analytics]       累計: 50 支 | 繼續下一頁
[Analytics]     → 正在獲取第 2 頁...
[Analytics]       ✓ 本頁: 50/50 支影片在範圍內 (2025/2/28 ~ 2024/12/1)
[Analytics]       累計: 100 支 | 繼續下一頁
[Analytics]     → 正在獲取第 3 頁...
[Analytics]       ✓ 本頁: 15/50 支影片在範圍內
[Analytics]       ⚠ 發現超過截止日期的影片 (2024/10/28)，停止獲取
[Analytics]       累計: 115 支 | 已達截止日期
[Analytics] ✓ 分頁查詢完成：共 3 頁，115 支影片
[Analytics] 找到 115 支影片（近 365 天內發布）
[Analytics] 查詢日期範圍: 2024-11-04 到 2025-11-04
[Analytics] 成功獲取 115 支影片的分析數據
[Analytics] 計算完成，找到 X 支建議更新的影片
```

**檢查點：**
- [ ] 是否正確獲取到近 1 年的影片？
- [ ] 分頁是否在超過日期時自動停止？
- [ ] 沒有出現錯誤訊息？

#### **2.2 驗證日誌關鍵指標**
```bash
# 在終端查看日誌
grep "\[Analytics\]" # 過濾分析相關日誌
```

**重點檢查：**
- **分頁數量**：應該只抓取必要的頁數（1 年約 2-3 頁）
- **影片數量**：是否接近預期數量
- **停止條件**：是否因「發現超過截止日期」而停止

---

### ✅ 階段 3：前端 UI 測試

#### **3.1 影片列表顯示**
- [ ] 顯示前 50 支建議更新的影片
- [ ] 排名徽章正確（前 10 名紅色，其他藍色）
- [ ] 顯示關鍵指標：觀看次數、觀看時長、搜尋流量、優先分數
- [ ] 顯示更新建議標籤（紅色）

#### **3.2 下拉展開功能**
- [ ] 點擊影片卡片 → 下方展開詳細資訊
- [ ] 邊框變為藍色 (`#0077B6`)
- [ ] 顯示「▲ 點擊收合」文字
- [ ] 再次點擊 → 收合

#### **3.3 詳細資訊區域**
- [ ] YouTube 連結可點擊
- [ ] 核心指標（6 個）正確顯示
- [ ] 流量來源正確顯示
- [ ] 總搜尋流量佔比正確計算

---

### ✅ 階段 4：AI 關鍵字分析測試

#### **4.1 觸發分析**
1. 展開任一影片
2. 點擊「🤖 AI 關鍵字分析」按鈕
3. 等待分析完成（約 5-10 秒）

**檢查點：**
- [ ] 顯示載入動畫（Loader）
- [ ] 分析完成後顯示完整結果
- [ ] 關鍵字評分（0-100）正確顯示
- [ ] 顏色編碼正確：
  - 綠色（≥70）
  - 黃色（40-69）
  - 紅色（<40）
- [ ] 優勢/弱點清單顯示
- [ ] 建議關鍵字（核心、次要、長尾）顯示
- [ ] 標題建議（3 個）顯示
- [ ] 行動計畫顯示

#### **4.2 快取功能**
1. 收合影片
2. 再次展開同一支影片
3. **檢查：** AI 分析結果應立即顯示（不重新分析）
4. **檢查：** 按鈕文字變為「✓ 已分析 - 重新分析」

---

### ✅ 階段 5：中繼資料生成測試

#### **5.1 打開中繼資料生成器**
1. 展開任一影片
2. 點擊「✨ 生成中繼資料」按鈕

**檢查點：**
- [ ] 顯示「正在載入影片資訊...」
- [ ] 成功載入後顯示「額外提示」輸入框
- [ ] 顯示「使用 Gemini AI 生成 SEO 強化內容」按鈕

#### **5.2 生成內容**
1. （可選）輸入額外提示
2. 點擊「生成」按鈕
3. 觀察進度訊息

**預期流程：**
```
檢查雲端檔案 → 分析影片內容 → 生成 SEO 強化建議
```

**檢查點：**
- [ ] 顯示載入狀態與進度文字
- [ ] 生成完成後顯示：
  - [ ] 3 個標題選項（A/B/C）
  - [ ] 可編輯的標題欄位
  - [ ] 影片說明（含章節）
  - [ ] SEO 標籤
- [ ] 可選擇不同標題選項
- [ ] 選擇後自動更新可編輯欄位

#### **5.3 更新到 YouTube**
1. 編輯標題/說明/標籤
2. 點擊對應的「Update」按鈕
3. 觀察按鈕狀態變化

**預期狀態：**
```
Update → (載入動畫) → ✓ (成功) → Update
```

---

### ✅ 階段 6：快取功能測試

#### **6.1 localStorage 快取**
1. 完成一次分析
2. **重新整理頁面**（F5）
3. **檢查：** 分析數據應自動載入（不需重新分析）
4. **檢查：** 顯示「近 X 年內發布」文字

#### **6.2 清除快取**
1. 點擊「🗑️ 清除快取」按鈕
2. **檢查：** 所有數據消失
3. **檢查：** 回到初始狀態（顯示年度選擇器）

#### **6.3 快取過期**
1. 修改瀏覽器時間（往後調 25 小時）
2. 重新整理頁面
3. **檢查：** 快取自動失效（需重新分析）

---

### ✅ 階段 7：載入更多功能

#### **7.1 載入下一年**
1. 完成 1 年分析
2. 點擊「⏳ 載入更多（往前 1 年）」
3. **觀察後端日誌**

**預期日誌：**
```
[Analytics] 開始獲取頻道影片列表（近 730 天）...
[Analytics]   截止日期: 2023/11/4
...
```

**檢查點：**
- [ ] 新舊數據自動合併
- [ ] 沒有重複的影片
- [ ] 摘要顯示「近 2 年內發布」
- [ ] 影片數量增加

---

## 🐛 常見問題排查

### **問題 1：只獲取到 41 支影片**
**原因：** 使用舊的 `search.list` API
**解決：** 已改用 `playlistItems.list`，重新測試

### **問題 2：抓取了所有影片（包含 2 年前的）**
**原因：** 沒有邊抓取邊檢查日期
**解決：** 已加入日期檢查並提前停止，檢查日誌是否有「發現超過截止日期」訊息

### **問題 3：快取沒有生效**
**檢查：**
```javascript
// 開啟瀏覽器控制台
localStorage.getItem('videoAnalyticsData')
localStorage.getItem('videoAnalyticsTimestamp')
```

### **問題 4：中繼資料生成失敗**
**檢查：**
1. 是否登入 YouTube
2. 影片隱私狀態（未列出的影片需下載）
3. Gemini API 金鑰是否正確設定

---

## 📊 性能驗證

### **API 配額使用**

**理論值：**
| 操作 | 舊方法 | 新方法 | 節省 |
|------|--------|--------|------|
| 獲取 1 年影片 | 600 單位 | 3 單位 | 99.5% |
| 獲取 2 年影片 | 600 單位 | 6 單位 | 99% |

**驗證方法：**
1. 查看 Google Cloud Console
2. API & Services → YouTube Data API v3 → Quotas
3. 記錄使用量變化

---

## ✅ 測試完成清單

- [ ] 基本功能正常
- [ ] 數據獲取正確（檢查日誌）
- [ ] UI 互動流暢
- [ ] AI 關鍵字分析成功
- [ ] 中繼資料生成成功
- [ ] 快取功能正常
- [ ] 載入更多功能正常
- [ ] 沒有控制台錯誤
- [ ] 沒有後端錯誤

---

## 📝 測試報告範本

```
### 測試日期：2025-11-04
### 測試人員：[您的名字]

#### ✅ 通過的測試
- [x] 基本功能
- [x] 數據獲取（1 年：115 支影片，3 頁）
- [ ] ...

#### ❌ 失敗的測試
- 問題描述：...
- 錯誤訊息：...
- 重現步驟：...

#### 📊 性能數據
- API 配額使用：3 單位 / 1 年分析
- 載入時間：約 5 秒
- 影片數量：115 支（1 年）
```

---

## 🚨 緊急聯絡

如遇到無法解決的問題，請提供：
1. 後端完整日誌
2. 瀏覽器控制台錯誤
3. 操作步驟
4. 預期結果 vs 實際結果
