# é »é“åˆ†ææœå°‹ç­–ç•¥ï¼šä½¿ç”¨ Video Cache å„ªåŒ– API é…é¡

æœ¬æ–‡ä»¶æ—¨åœ¨è§£é‡‹ AI Video Writer ä¸­ï¼Œé »é“åˆ†ææœå°‹åŠŸèƒ½å¦‚ä½•ä½¿ç”¨ Video Cache ä¾†æ¸›å°‘ YouTube API é…é¡ä½¿ç”¨ï¼ŒåŒæ™‚ä¿è­‰æ•¸æ“šçš„ä¸€è‡´æ€§ã€å®Œæ•´æ€§åŠæœå°‹è¡Œç‚ºçš„ç©©å®šæ€§ã€‚

## ğŸš€ å„ªåŒ–ç­–ç•¥ï¼šVideo Cache

### èƒŒæ™¯

ä¹‹å‰çš„å¯¦ç¾æ¡ç”¨ `youtube.search.list` æˆ– `playlistItems.list` æ­é… `youtube.videos.list` ä¾†ç²å–å½±ç‰‡åˆ—è¡¨ï¼Œé€™æœƒæ¶ˆè€—å¤§é‡çš„ API é…é¡ã€‚ç‚ºäº†æ¸›å°‘é…é¡ä½¿ç”¨ï¼Œæˆ‘å€‘å¼•å…¥äº† Video Cache æ©Ÿåˆ¶ã€‚

### Video Cache å·¥ä½œåŸç†

1. **å®šæœŸæ›´æ–°å¿«å–**ï¼šé€é GitHub Actions workflowï¼Œæ¯å¤©è‡ªå‹•åŸ·è¡Œ `update-video-cache.js` è…³æœ¬ï¼Œå°‡æ‰€æœ‰å½±ç‰‡çš„åŸºæœ¬è³‡è¨Šï¼ˆvideoIdã€titleã€tagsã€publishedAt ç­‰ï¼‰å„²å­˜åˆ° GitHub Gist
2. **å¾å¿«å–è®€å–**ï¼šé »é“åˆ†æåŠŸèƒ½å„ªå…ˆå¾ Gist è¼‰å…¥å¿«å–çš„å½±ç‰‡åˆ—è¡¨ï¼Œè€Œä¸æ˜¯ç›´æ¥èª¿ç”¨ YouTube API
3. **æ¸›å°‘ API èª¿ç”¨**ï¼šåªæœ‰åœ¨å¿«å–ä¸å¯ç”¨æˆ–éæœŸæ™‚ï¼Œæ‰å›é€€åˆ°åŸæœ‰çš„ YouTube API æ–¹å¼

## ğŸ’¡ æ ¸å¿ƒè€ƒé‡

### 1. è³‡æ–™ä¾†æºä¸€è‡´æ€§èˆ‡æ•ˆèƒ½

-   **åŸå•é¡Œ**ï¼šè‹¥é »é“åˆ†æåƒ…æƒææ’­æ”¾æ¸…å–® (`playlistItems.list`)ï¼Œæœƒå—é™æ–¼ API çš„åˆ†é ä¸Šé™ï¼ˆä¾‹å¦‚ 40 é ï¼‰ï¼Œä¸”å½±ç‰‡éš±ç§ç‹€æ…‹æˆ–æ’åºè®Šæ›´å¯èƒ½å°è‡´éºæ¼ã€‚
-   **ä¹‹å‰è§£æ±ºæ–¹æ¡ˆ**ï¼šæ¡ç”¨ `youtube.search.list` æ­é… `youtube.videos.list` ç­–ç•¥ï¼Œä½†æœƒæ¶ˆè€—å¤§é‡é…é¡ï¼ˆsearch.list æ¯æ¬¡ 100 é…é¡ï¼‰ã€‚
-   **æ–°è§£æ±ºæ–¹æ¡ˆ**ï¼šä½¿ç”¨ Video Cache å„²å­˜å®Œæ•´çš„å½±ç‰‡åˆ—è¡¨ï¼Œå¾ Gist è®€å–æ™‚ä¸æ¶ˆè€— YouTube API é…é¡ã€‚å¿«å–ç”±å®šæœŸè…³æœ¬ç¶­è­·ï¼Œç¢ºä¿æ•¸æ“šçš„å®Œæ•´æ€§å’Œæ™‚æ•ˆæ€§ã€‚

### 2. åŒ…å«æ‰€æœ‰å½±ç‰‡é¡å‹

-   **å•é¡Œ**ï¼šåƒ…ä¾è³´æ’­æ”¾æ¸…å–®æˆ–å…¬é–‹ç¯©é¸æœƒéºæ¼æœªå…¬é–‹æˆ–ç§äººå½±ç‰‡çš„æ•¸æ“šï¼Œå°è‡´åˆ†æçµæœèˆ‡å¯¦éš›æƒ…æ³ï¼ˆå¦‚ YouTube Studio æˆ– Looker Studioï¼‰ä¸ç¬¦ã€‚
-   **è§£æ±ºæ–¹æ¡ˆ**ï¼šVideo Cache ä½¿ç”¨ `playlistItems.list` æ­é… `videos.list` ä¾†æŠ“å–æ‰€æœ‰å½±ç‰‡ï¼ˆåŒ…å«å…¬é–‹ã€æœªåˆ—å‡ºã€ç§äººï¼‰ï¼Œä¸¦å°‡ `privacyStatus` ä¸€ä½µå„²å­˜ã€‚é »é“åˆ†æå¾å¿«å–è®€å–æ™‚ï¼Œå³å¯ç²å¾—æ‰€æœ‰å½±ç‰‡çš„å®Œæ•´åˆ—è¡¨ã€‚

### 3. ç©©å®šçš„é—œéµå­—æœå°‹è¡Œç‚º

-   **å•é¡Œ**ï¼šå¦‚æœè‡ªè¡Œéæ­·æ’­æ”¾æ¸…å–®ä¸¦æ‰‹å‹•æ¯”å°æ¨™é¡Œ/æè¿°ï¼Œæœå°‹çµæœæœƒå—è³‡æ–™é‡ã€å¤§å°å¯«ã€èªç³»ç­‰å› ç´ å½±éŸ¿ï¼Œé›£ä»¥ä¿æŒä¸€è‡´æ€§ã€‚
-   **è§£æ±ºæ–¹æ¡ˆ**ï¼šVideo Cache å„²å­˜äº†å®Œæ•´çš„å½±ç‰‡æ¨™é¡Œå’Œ tagsï¼Œé »é“åˆ†æåœ¨å®¢æˆ¶ç«¯é€²è¡Œé—œéµå­—éæ¿¾ï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰ï¼Œç¢ºä¿æœå°‹è¡Œç‚ºçš„ç©©å®šæ€§å’Œä¸€è‡´æ€§ã€‚

### 4. ç²¾æº–çš„æ•¸æ“šå°æ‡‰

-   **å•é¡Œ**ï¼šå¦‚æœåœ¨æœå°‹éšæ®µå°±éºæ¼äº†å½±ç‰‡ï¼Œå¾ŒçºŒçš„åˆ†æï¼ˆå¦‚ `youtubeAnalytics.reports.query`ï¼‰ç„¡è«–å¤šéº¼å®Œæ•´ä¹Ÿç„¡æ³•å½Œè£œã€‚
-   **è§£æ±ºæ–¹æ¡ˆ**ï¼šVideo Cache ç¢ºä¿ç²å¾—å®Œæ•´çš„ `videoId` é›†åˆï¼Œå†ä½¿ç”¨é€™äº› `videoId` æŸ¥è©¢ `youtubeAnalytics.reports.query`ï¼Œå³å¯ç²¾ç¢ºå°æ‡‰æ¯æ”¯å½±ç‰‡åœ¨æŒ‡å®šæ—¥æœŸç¯„åœå…§çš„è§€çœ‹æ•¸å’Œäº’å‹•æ•¸ï¼Œç¢ºä¿åˆ†æçš„æº–ç¢ºæ€§ã€‚

### 5. API é…é¡å„ªåŒ–

-   **å•é¡Œ**ï¼šæ¯æ¬¡é »é“åˆ†æéƒ½éœ€è¦æœå°‹å½±ç‰‡åˆ—è¡¨ï¼Œæœƒæ¶ˆè€—å¤§é‡ API é…é¡ï¼ˆ`search.list` æ¯æ¬¡ 100 é…é¡ï¼‰ã€‚
-   **è§£æ±ºæ–¹æ¡ˆ**ï¼š
    -   å¾ Gist è®€å– Video Cache **ä¸æ¶ˆè€—** YouTube API é…é¡
    -   åªæœ‰å®šæœŸæ›´æ–°å¿«å–æ™‚æ‰æœƒä½¿ç”¨ APIï¼ˆé€šå¸¸æ¯å¤©ä¸€æ¬¡ï¼Œç”± GitHub Actions è‡ªå‹•åŸ·è¡Œï¼‰
    -   å¤§å¹…é™ä½æ—¥å¸¸ä½¿ç”¨çš„é…é¡æ¶ˆè€—ï¼Œå°‡é…é¡ç•™çµ¦çœŸæ­£éœ€è¦çš„æ“ä½œï¼ˆå¦‚ç²å– Analytics æ•¸æ“šï¼‰

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### å¿«å–æ›´æ–°æµç¨‹

```javascript
// scripts/update-video-cache.js
// æ¯å¤©è‡ªå‹•åŸ·è¡Œï¼Œæ›´æ–°å¿«å–åˆ° Gist
```

### é »é“åˆ†æä½¿ç”¨å¿«å–

```javascript
// services/channelAnalyticsService.js
async function searchChannelVideosFromCache(keyword) {
  // 1. å¾ Gist è¼‰å…¥å¿«å–
  const cache = await loadFromGist(gistId, gistToken);

  // 2. è½‰æ›æ ¼å¼
  let videos = cache.videos.map(v => ({
    videoId: v.videoId,
    title: v.title,
    tags: v.tags || [],
    publishedAt: v.publishedAt,
    thumbnail: v.thumbnail,
    privacyStatus: v.privacyStatus || 'public',
  }));

  // 3. é—œéµå­—éæ¿¾
  if (keyword) {
    videos = filterVideosByKeywordClient(videos, keyword);
  }

  return videos;
}
```

### Fallback æ©Ÿåˆ¶

å¦‚æœ Video Cache ä¸å¯ç”¨ï¼ˆä¾‹å¦‚ï¼šGist ID æœªè¨­å®šã€ç¶²è·¯éŒ¯èª¤ç­‰ï¼‰ï¼Œç³»çµ±æœƒè‡ªå‹•å›é€€åˆ°åŸæœ‰çš„ YouTube API æ–¹å¼ï¼š

```javascript
try {
  videos = await searchChannelVideosFromCache(keyword);
} catch (cacheError) {
  // å›é€€åˆ° YouTube API
  videos = await searchChannelVideos(youtube, channelId, keyword);
}
```

## ğŸ“Š æ•ˆèƒ½æ¯”è¼ƒ

| æ–¹å¼ | API é…é¡æ¶ˆè€— | é€Ÿåº¦ | æ•¸æ“šå®Œæ•´æ€§ |
|------|-------------|------|-----------|
| **Video Cache (æ–°)** | **0 é…é¡**ï¼ˆè®€å–æ™‚ï¼‰ | å¿« | å®Œæ•´ï¼ˆä¾è³´å®šæœŸæ›´æ–°ï¼‰ |
| Search API (èˆŠ) | 100 é…é¡/æ¬¡ | æ…¢ | å®Œæ•´ |
| Playlist API (èˆŠ) | 2-4 é…é¡/é  | ä¸­ç­‰ | å¯èƒ½éºæ¼ |

## ğŸ¯ ç’°å¢ƒè®Šæ•¸è¨­å®š

ä½¿ç”¨ Video Cache éœ€è¦åœ¨ `.env.local` ä¸­è¨­å®šï¼š

```bash
# GitHub Gist (ç”¨æ–¼å½±ç‰‡å¿«å–)
GITHUB_GIST_TOKEN=your_github_personal_access_token_here
GITHUB_GIST_ID=your_gist_id_here
GITHUB_GIST_FILENAME=youtube-videos-cache.json
```

## çµè«–

æ¡ç”¨ Video Cache ç­–ç•¥ï¼Œä¸åƒ…ç¢ºä¿ AI Video Writer é »é“åˆ†æåŠŸèƒ½æ•¸æ“šæº–ç¢ºã€è¡Œç‚ºç©©å®šï¼Œæ›´å¤§å¹…æ¸›å°‘äº† YouTube API é…é¡çš„ä½¿ç”¨ã€‚é€™è®“æˆ‘å€‘èƒ½å°‡æœ‰é™çš„é…é¡ç”¨åœ¨çœŸæ­£éœ€è¦çš„åœ°æ–¹ï¼ˆå¦‚ Analytics æŸ¥è©¢ï¼‰ï¼Œæå‡æ•´é«”ç³»çµ±çš„æ•ˆèƒ½å’Œå¯ç”¨æ€§ã€‚