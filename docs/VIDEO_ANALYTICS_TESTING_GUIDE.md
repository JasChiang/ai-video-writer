# 📊 影片表現分析功能：測試指南

本指南提供 AI Video Writer 應用程式中「影片表現分析」功能的詳細測試步驟與檢查清單，旨在確保該功能在數據獲取、UI 顯示、AI 分析及快取機制方面的正確性與穩定性。

## 🚀 測試環境準備

在開始測試之前，請確保您的開發環境已正確啟動：

### 1. 啟動後端服務器

```bash
npm run server
```
後端服務器應在 `http://localhost:3001` 啟動。

### 2. 啟動前端應用程式

```bash
npm run dev
```
前端應用程式應在 `http://localhost:3000` 啟動。

> **提示**：您也可以使用 `npm run dev:all` 同時啟動前後端。

## 📋 測試檢查清單

### ✅ 階段 1：基本功能與導航測試

#### 1.1 YouTube 登入
-   [ ] 打開應用程式 (`http://localhost:3000`)。
-   [ ] 點擊「Sign in with Google」按鈕。
-   [ ] 確認成功登入（頁面顯示用戶頭像或影片列表）。

#### 1.2 進入影片表現分析頁面
-   [ ] 點擊頁面頂部的「📊 影片分析」標籤。
-   [ ] 確認頁面顯示年度選擇器（1/2/3/5 年選項）。
-   [ ] 確認頁面顯示「🚀 開始分析」按鈕。

### ✅ 階段 2：數據獲取與後端邏輯測試

#### 2.1 執行基本分析 (1 年)
1.  在年度選擇器中選擇「1 年」。
2.  點擊「🚀 開始分析」按鈕。
3.  **觀察後端服務器日誌** (運行 `npm run server` 的終端機)。

**預期後端日誌輸出範例**：
```
[Analytics API] 開始分析頻道: UCUR0yPZFOmf7maQWGlA6q2w
[Analytics] 開始獲取頻道影片列表（近 365 天）...
[Analytics]   截止日期: 2025/11/4
[Analytics]   → 步驟 1: 獲取頻道資訊...
[Analytics]     ✓ 上傳播放清單 ID: UU...
[Analytics]   → 步驟 2: 開始分頁查詢影片...
[Analytics]     → 正在獲取第 1 頁 (pageToken: 首頁)
[Analytics]       ✓ 本頁: 50/50 支影片在範圍內 (2025/11/3 ~ 2025/3/1)
[Analytics]       累計: 50 支 | 繼續下一頁
[Analytics]     → 正在獲取第 2 頁...
[Analytics]       ✓ 本頁: 50/50 支影片在範圍內 (2025/2/28 ~ 2024/12/1)
[Analytics]       累計: 100 支 | 繼續下一頁
[Analytics]     → 正在獲取第 3 頁...
[Analytics]       ✓ 本頁: 15/50 支影片在範圍內
[Analytics]       ⚠ 發現超過截止日期的影片 (2024/10/28)，停止獲取
[Analytics]       累計: 115 支 | 已達截止日期
[Analytics] ✓ 分頁查詢完成：共 3 頁，115 支影片
[Analytics] 找到 115 支影片（近 365 天內發布）
[Analytics] 查詢日期範圍: 2024-11-04 到 2025-11-04
[Analytics] 成功獲取 115 支影片的分析數據
[Analytics] 計算完成，找到 X 支建議更新的影片
```

**檢查點**：
-   [ ] 後端日誌是否正確顯示獲取近 1 年的影片列表？
-   [ ] 分頁查詢是否在遇到超出日期範圍的影片時自動停止？
-   [ ] 後端日誌中沒有出現任何錯誤訊息？
-   [ ] 獲取的影片數量是否符合預期？

### ✅ 階段 3：前端 UI 顯示與互動測試

#### 3.1 影片列表顯示
-   [ ] 頁面是否顯示前 50 支「建議更新」的影片（如果有的話）？
-   [ ] 影片卡片上的排名徽章是否正確顯示（例如，前 10 名為紅色，其他為藍色）？
-   [ ] 每張影片卡片是否顯示關鍵指標：觀看次數、觀看時長百分比、搜尋流量百分比、優先分數？
-   [ ] 是否顯示「更新建議」標籤（紅色），指示影片需要改進的原因？

#### 3.2 影片卡片展開/收合功能
-   [ ] 點擊任一影片卡片，確認下方是否展開顯示詳細資訊。
-   [ ] 展開時，影片卡片邊框是否變為紅色 (`#DC2626`)？
-   [ ] 展開時，卡片上是否顯示「▲ 點擊收合」文字？
-   [ ] 再次點擊已展開的影片卡片，確認是否正確收合。

#### 3.3 詳細資訊區域顯示
-   [ ] 展開後，確認 YouTube 連結是否可點擊並導向正確的影片頁面。
-   [ ] 核心指標（觀看次數、觀看時長百分比、按讚數、留言數、分享數、訂閱者增長）是否正確顯示？
-   [ ] 流量來源分析（YouTube 搜尋、Google 搜尋、建議影片、外部來源）是否正確顯示？
-   [ ] 總搜尋流量佔比是否正確計算？

### ✅ 階段 4：AI 關鍵字分析測試

#### 4.1 觸發分析
1.  展開任一影片卡片。
2.  點擊「🤖 AI 關鍵字分析」按鈕。
3.  **檢查**：按鈕是否顯示載入動畫 (Loader)，並顯示「分析中...」文字。
4.  **檢查**：分析完成後，是否顯示完整的 AI 分析結果。

#### 4.2 AI 分析結果顯示
-   [ ] 關鍵字評分（0-100）是否正確顯示？
-   [ ] 評分顏色編碼是否正確（綠色 ≥70，黃色 40-69，紅色 <40）？
-   [ ] 是否顯示「優勢」和「弱點」清單？
-   [ ] 是否顯示「建議關鍵字」（核心、次要、長尾）？
-   [ ] 是否顯示「標題建議」（3 個）和「行動計畫」？

#### 4.3 快取功能驗證
1.  收合已分析的影片卡片。
2.  再次展開同一支影片卡片。
3.  **檢查**：AI 分析結果是否立即顯示，無需重新分析。
4.  **檢查**：按鈕文字是否變為「✓ 已分析 - 重新分析」。

### ✅ 階段 5：中繼資料生成測試

#### 5.1 打開中繼資料生成器
1.  展開任一影片卡片。
2.  點擊「✨ 生成中繼資料」按鈕。
3.  **檢查**：是否顯示「正在載入影片資訊...」的載入狀態。
4.  **檢查**：成功載入後，是否顯示「額外提示」輸入框和「使用 Gemini AI 生成 SEO 強化內容」按鈕。

#### 5.2 生成內容
1.  (可選) 在「額外提示」輸入框中輸入一些提示。
2.  點擊「使用 Gemini AI 生成 SEO 強化內容」按鈕。
3.  **檢查**：是否顯示載入狀態與進度文字（例如「檢查雲端檔案 → 分析影片內容 → 生成 SEO 強化建議」）。
4.  **檢查**：生成完成後，是否顯示：
    -   3 個標題選項（A/B/C）。
    -   可編輯的標題欄位。
    -   影片說明（包含章節）。
    -   SEO 標籤。
5.  [ ] 點擊不同的標題選項，確認可編輯欄位是否自動更新。

#### 5.3 更新到 YouTube
1.  編輯標題/說明/標籤欄位。
2.  點擊對應的「Update」按鈕。
3.  **檢查**：按鈕狀態是否從「Update」變為載入動畫，然後變為「✓ (成功)」，最後恢復為「Update」。
4.  **檢查**：確認 YouTube 影片的實際中繼資料是否已更新。

### ✅ 階段 6：快取功能測試 (前端數據快取)

#### 6.1 localStorage 快取
1.  完成一次完整的影片分析。
2.  **重新整理頁面** (F5)。
3.  **檢查**：分析數據是否自動載入，無需重新分析。
4.  **檢查**：頁面頂部是否顯示「近 X 年內發布」文字。

#### 6.2 清除快取
1.  點擊「🗑️ 清除快取」按鈕。
2.  **檢查**：所有分析數據是否消失，頁面是否回到初始狀態（顯示年度選擇器）。

#### 6.3 快取過期
1.  完成一次分析後，將瀏覽器時間手動調整為未來 25 小時。
2.  重新整理頁面。
3.  **檢查**：快取是否自動失效，應用程式要求重新分析。

### ✅ 階段 7：載入更多功能測試

#### 7.1 載入下一年數據
1.  完成 1 年分析。
2.  點擊「⏳ 載入更多（往前 1 年）」按鈕。
3.  **觀察後端日誌**。

**預期後端日誌**：
```
[Analytics] 開始獲取頻道影片列表（近 730 天）...
[Analytics]   截止日期: 2023/11/4
...
```

**檢查點**：
-   [ ] 新舊數據是否自動合併，沒有重複的影片。
-   [ ] 頁面摘要是否顯示「近 2 年內發布」。
-   [ ] 影片總數量是否增加。

## 🐛 常見問題排查

-   **問題：只獲取到少量影片**
    -   **檢查**：後端日誌中是否有「發現超過截止日期」的訊息，確認是否因日期過濾而提前停止。
-   **問題：快取沒有生效**
    -   **檢查**：瀏覽器開發者工具的 `localStorage` 中是否有 `videoAnalyticsData` 和 `videoAnalyticsTimestamp` 鍵值。
-   **問題：中繼資料生成失敗**
    -   **檢查**：是否已登入 YouTube？影片隱私狀態是否為公開（未列出/私人影片可能需要下載）？`GEMINI_API_KEY` 是否正確設定？

## 📊 性能驗證

### API 配額使用

**理論值 (範例：獲取 1 年影片)**：
-   **舊方法 (每次搜尋都呼叫 `search.list`)**：約 600 單位
-   **新方法 (使用 `playlistItems.list` 配合日期過濾)**：約 3 單位
-   **節省**：約 99.5%

**驗證方法**：
1.  前往 [Google Cloud Console](https://console.cloud.google.com/apis/dashboard)。
2.  導航至「API 和服務」→「YouTube Data API v3」→「配額」。
3.  記錄分析前後的配額使用量變化。

## 📝 測試報告範本

```markdown
### 測試日期：YYYY-MM-DD
### 測試人員：[您的名字]

#### ✅ 通過的測試
- [x] 基本功能
- [x] 數據獲取（例如：1 年分析，115 支影片，3 頁）
- [x] 前端 UI 顯示與互動
- [x] AI 關鍵字分析
- [x] 中繼資料生成
- [x] 快取功能
- [x] 載入更多功能

#### ❌ 失敗的測試
- **問題描述**：...
- **錯誤訊息**：...
- **重現步驟**：...

#### 📊 性能數據
- **API 配額使用**：[例如：3 單位 / 1 年分析]
- **載入時間**：[例如：約 5 秒]
- **影片數量**：[例如：115 支 (1 年)]
```

---

## 🚨 緊急聯絡

如遇到無法解決的問題，請提供以下詳細資訊：
1.  後端完整日誌。
2.  瀏覽器控制台錯誤訊息。
3.  詳細的操作步驟。
4.  預期結果與實際結果的對比。
5.  您的作業系統、Node.js 版本、Docker 版本（如果使用）。